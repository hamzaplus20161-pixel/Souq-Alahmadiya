<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Iron Man Hand Tracking Mobile</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  overflow: hidden;
  background: black;
  font-family: Arial;
}

#hud {
  position: fixed;
  top: 15px;
  left: 15px;
  color: cyan;
  font-size: 16px;
  text-shadow: 0 0 10px cyan;
  z-index: 10;
}

video {
  display: none;
}
</style>
</head>

<body>

<div id="hud">
IRON MODE – MOBILE<br>
✋ Hand Tracking Active
</div>

<video id="video" autoplay playsinline></video>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script>
// ===== THREE =====
const scene = new THREE.Scene();

const camera3D = new THREE.PerspectiveCamera(
  75,
  window.innerWidth / window.innerHeight,
  0.1,
  1000
);
camera3D.position.z = 6;

const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Light
const light = new THREE.PointLight(0x00ffff, 2, 100);
light.position.set(0, 5, 10);
scene.add(light);

// Cursor
const geo = new THREE.BoxGeometry(0.6, 0.6, 0.6);
const mat = new THREE.MeshStandardMaterial({
  color: 0x00ffff,
  emissive: 0x00ffff,
  emissiveIntensity: 0.7
});
const cursor = new THREE.Mesh(geo, mat);
scene.add(cursor);

// Voxels
const voxels = new THREE.Group();
scene.add(voxels);

function animate() {
  requestAnimationFrame(animate);
  renderer.render(scene, camera3D);
}
animate();

// ===== MEDIAPIPE =====
const video = document.getElementById("video");

const hands = new Hands({
  locateFile: file =>
    `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
});

hands.setOptions({
  maxNumHands: 1,
  modelComplexity: 1,
  minDetectionConfidence: 0.7,
  minTrackingConfidence: 0.7
});

let lastAdd = 0;

hands.onResults(results => {
  if (!results.multiHandLandmarks) return;

  const lm = results.multiHandLandmarks[0];
  const index = lm[8];
  const thumb = lm[4];

  // Move cursor
  cursor.position.x = (index.x - 0.5) * 6;
  cursor.position.y = -(index.y - 0.5) * 4;
  cursor.position.z = -index.z * 5;

  // Pinch to add block
  const dist = Math.hypot(index.x - thumb.x, index.y - thumb.y);
  if (dist < 0.04 && Date.now() - lastAdd > 500) {
    addVoxel();
    lastAdd = Date.now();
  }
});

function addVoxel() {
  const cube = cursor.clone();
  cube.position.set(
    Math.round(cursor.position.x),
    Math.round(cursor.position.y),
    Math.round(cursor.position.z)
  );
  voxels.add(cube);
}

// Camera (IMPORTANT)
const cam = new Camera(video, {
  onFrame: async () => {
    await hands.send({ image: video });
  },
  width: 640,
  height: 480,
  facingMode: "user" // front camera
});

cam.start();

// Resize
window.addEventListener("resize", () => {
  camera3D.aspect = window.innerWidth / window.innerHeight;
  camera3D.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>

</body>
</html>